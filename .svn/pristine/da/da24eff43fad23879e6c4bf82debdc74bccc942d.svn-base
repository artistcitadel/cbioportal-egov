<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC  
 "-//mybatis.org//DTD Mapper 3.0//EN"  
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
 
 <!-- 개인자료 저장 -->
 <mapper namespace="research_personal_data">
	<select id="selectConvertSbstNo" parameterType="map" resultType="hashMap">
		SELECT 	${GV_PAT_SBST_NO}
		FROM 	${SCHEMA_TABLE_SECU}
		WHERE 	1=1
		
		<if test="SEARCH_KEY == 'PAT_NAID'">
			AND 	PAT_NAID = #{SEARCH_VAL}
		</if>
		
		<if test="SEARCH_KEY == 'PAT_ID'">
			<choose>
				<when test='SEARCH_PAT_ID_LPAD_YN == "Y"'>
					AND 	${PID} = LPAD(#{SEARCH_VAL},${SEARCH_PAT_ID_LPAD_SIZE},'0')
				</when>
				
				<otherwise>
					AND 	${PID} = #{SEARCH_VAL}
				</otherwise>
			</choose>
		</if>
		
	</select>
	<select id="selectLabNoConvertSbstNo" parameterType="map" resultType="hashMap">
		SELECT 	${GV_PAT_SBST_NO}
		FROM 	${SCHEMA_TABLE_SECU}
		WHERE 	1=1
				AND PAT_LAB_NO = #{SEARCH_VAL}
		
	</select>
	<insert id="createPsnlDataTable" parameterType="map">
		${CREATE_SQL}
	</insert>
	
	<insert id="insertPsnlDataTable" parameterType="map">
		${INSERT_SQL}
	</insert>
	
	<insert id="insertPsnlDataItemMgmt" parameterType="map">
		INSERT
	INTO
		CC_ITEM_MGMT(
			
			`SCHEMA`,
			`TABLE`,
			TABLE_COMMENT,
			`COLUMN`,
			COLUMN_COMMENT,
			DATA_TYPE,
			ITEM_NM,
			`ORDER`,
			SEARCH_YN,
			ITEM_TYPE,
			CODE_TYPE,
			CODE_SET,
			POPUP_YN,
			POPUP_PROGRAM_ID,
			UPPER_TABLE,
			UPPER_COLUMN,
			GMEC_YN,
			HCC_YN,
			SYNONYM_YN,
			ITEM_DESC,
			UDT_DT,
			ITEM_CATE_SEQ,
			ITEM_CATE_DETL_SEQ,
			UDT_ID,
			CRT_ID,
			CRT_DT,
			ITEM_CATE,
			ITEM_CATE_DETL,
			BASE_DT_COLUMN
		)
	VALUES(
		 #{SCHEMA}
		,#{TABLE}
		,#{TABLE_COMMENT}
		,#{COLUMN}
		,#{COLUMN_COMMENT}
		,#{DATA_TYPE}
		,#{ITEM_NM}
		,1
		,'Y'
		,#{ITEM_TYPE}
		,#{CODE_TYPE}
		,#{CODE_SET}
		,'N'
		,''
		,''						/* UPPER_TABLE 	*/
		,''						/* UPPER_COLUMN */
		,#{GMEC_YN}					/* GMEC_YN 		*/
		,#{HCC_YN}					/* HCC_YN 		*/
		,#{SYNONYM_YN}					/* SYNONYM_YN 	*/
		,#{ITEM_DESC}
		,NOW()
		,#{ITEM_CATE_SEQ}
		,#{ITEM_CATE_DETL_SEQ}
		,#{UDT_ID}
		,#{CRT_ID}
		,NOW()
		,#{ITEM_CATE}
		,#{ITEM_CATE_DETL}
		,#{BASE_DT_COLUMN}
	)
	
	</insert>
	<delete id="dropPsnlDataTable" parameterType="map">${QUERY}</delete>
	<select id="selectItemMgmtPsnlDataNmDuplicateCheck" parameterType="map" resultType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM CC_ITEM_MGMT 
		WHERE ITEM_CATE_SEQ=999 
		AND ITEM_DESC=#{SEARCH_ITEM_DESC}				/* 사용자id */
		AND ITEM_CATE_DETL=#{SEARCH_ITEM_CATE_DETL}		/* 데이터명 */
		
	</select>

</mapper>
 
 
 