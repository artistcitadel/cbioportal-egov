SELECT EXAM_SLIP_CD, NVL(EXAM_SLIP_KOR_NM,EXAM_SLIP_CD) , EXAM_CD, EXAM_KOR_NM, RCEP_DT  FROM CLSPNEXRT
WHERE RESCH_PAT_ID = '6128737361'
group by EXAM_SLIP_CD, NVL(EXAM_SLIP_KOR_NM,EXAM_SLIP_CD) , EXAM_CD, EXAM_KOR_NM
order by 1,3


WITH
 MAIN AS (
    SELECT EXAM_CD , EXAM_KOR_NM NAME, RCEP_DT ETIME, EXAM_SLIP_CD PID
    FROM CLSPNEXRT
    WHERE RESCH_PAT_ID = '6128737361'
    GROUP BY EXAM_SLIP_CD, NVL(EXAM_SLIP_KOR_NM, EXAM_SLIP_CD), EXAM_CD, EXAM_KOR_NM
),
  LEAF AS (
        SELECT DISTINCT T1. EXAM_CD, T1.EXAM_KOR_NM NAME FROM
          CLSPNEXRT AS T1 LEFT JOIN CLSPNEXRT as T2
          ON T1.EXAM_CD = T2.EXAM_SLIP_CD
          WHERE T1.RESCH_PAT_ID = '6128737361'
          AND T2.EXAM_CD IS NULL
    )
SELECT MAIN.*, LEAF.EXAM_CD
    FROM MAIN JOIN LEAF
WHERE MAIN.EXAM_CD = LEAF.EXAM_CD

SELECT EXAM_CD , EXAM_KOR_NM NAME, RCEP_DT ETIME, EXAM_SLIP_CD PID
    FROM CLSPNEXRT
    WHERE RESCH_PAT_ID = '6128737361'
    AND EXAM_CD = 'C30'
    GROUP BY EXAM_SLIP_CD, NVL(EXAM_SLIP_KOR_NM, EXAM_SLIP_CD), EXAM_CD, EXAM_KOR_NM


