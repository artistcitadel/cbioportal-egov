<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC  
 "-//mybatis.org//DTD Mapper 3.0//EN"  
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
 
 <mapper namespace="synonym">
	<select id="selectSynonymCategoryList" parameterType="map" resultType="hashmap">
		SELECT *
		FROM
		(
			SELECT   0 						AS lvl
					,'0' 					AS id
					,'-1' 					AS parentid
					,'전체' 					AS text
					,'../../images/folder.png' AS icon
					,'0' 					AS value
			UNION ALL
			
			SELECT   1 							AS lvl
					,A.ITEM_CATE_SEQ 			AS id
					,'0' 						AS parentid
					,B.CATE_NM 				AS text
					,'../../images/folder.png' 	AS icon
					,A.ITEM_CATE_SEQ			AS value
			FROM	CC_ITEM_MGMT A,CC_ITEM_CATE B
			WHERE 1=1
			AND 	A.ITEM_CATE_SEQ=B.SEQ
			AND 	A.ITEM_CATE_SEQ IS NOT NULL 
			AND 	A.ITEM_CATE_SEQ &lt;&gt; 0
			AND		A.ITEM_CATE_SEQ IN (
					SELECT  ITEM_CATE_SEQ 
					FROM	CC_ITEM_MGMT TB1
					WHERE	1=1
					AND 	TB1.SYNONYM_YN='Y'
			)
			GROUP BY A.ITEM_CATE_SEQ
					
			UNION ALL
			
			
			SELECT  2 AS lvl
					,B.ITEM_CATE_DETL_SEQ 	AS id
					,B.ITEM_CATE_SEQ 		AS parentid
					,C.CATE_NM 		AS text
					,'../../images/folder.png' AS icon
					,CONCAT(B.ITEM_CATE_SEQ,',',B.ITEM_CATE_DETL_SEQ) 			AS value
			FROM	CC_ITEM_MGMT B,CC_ITEM_CATE_DETL C
			WHERE 1=1
			AND B.ITEM_CATE_DETL_SEQ=C.SEQ
			AND 	B.ITEM_CATE_SEQ IS NOT NULL 
			AND 	B.ITEM_CATE_SEQ &lt;&gt; 0
			AND 	B.ITEM_CATE_DETL_SEQ IS NOT NULL
			AND		B.ITEM_CATE_DETL_SEQ IN (
					SELECT  ITEM_CATE_DETL_SEQ 
					FROM	CC_ITEM_MGMT TB1
					WHERE	1=1
					AND 	TB1.SYNONYM_YN='Y'
			)
			GROUP BY B.ITEM_CATE_SEQ
					,B.ITEM_CATE_DETL_SEQ
					,B.ITEM_CATE
					,B.ITEM_CATE_DETL
					
			UNION ALL
			
			SELECT   3 AS lvl
					,C.SEQ 					AS id
					,C.ITEM_CATE_DETL_SEQ 	AS parentid
					,C.ITEM_NM 				AS text
					,CASE C.ITEM_TYPE 	WHEN 'COD' THEN '../../images/COD.png'
										WHEN 'DAT' THEN '../../images/DAT.png'
										WHEN 'NUM' THEN '../../images/NUM.png'
										WHEN 'TEX' THEN '../../images/TEX.png'
			 		END AS icon
			 		
			 		,CONCAT(C.ITEM_CATE_SEQ,',',C.ITEM_CATE_DETL_SEQ,',',C.SEQ) 			AS value
			FROM	CC_ITEM_MGMT C
			WHERE 1=1
			AND 	C.ITEM_CATE_SEQ IS NOT NULL 
			AND 	C.ITEM_CATE_SEQ &lt;&gt; 0
			AND 	C.ITEM_CATE_DETL_SEQ IS NOT NULL
			AND 	C.SYNONYM_YN='Y'
		)D WHERE 1=1
		
				
	</select>
	<insert id="insertSynonym" parameterType="map" useGeneratedKeys="true" keyProperty="SEQ">
		INSERT INTO CC_SYNONYM 
		( 
			REP_SEQ ,TERM ,LANG ,REP_YN ,DELETE_YN
			,CRT_DT ,CRT_ID ,UDT_DT ,UDT_ID 
		) 
		VALUES 
		( 
			 #{REP_SEQ} 
			,#{TERM}
			,#{LANG} 
			,#{REP_YN} 
			,#{DELETE_YN} 
			,NOW() 
			,#{CRT_ID} 
			,NOW()
			,#{UDT_ID} 
		)
	</insert>
	<select id="selectSynonymList" parameterType="map" resultType="hashmap">
		SELECT   A.SEQ
				,A.REP_SEQ
				,A.TERM
				,(
					SELECT  GROUP_CONCAT(SYN.TERM SEPARATOR ', ')
					FROM	CC_SYNONYM SYN
					WHERE	1=1
					AND 	SYN.REP_SEQ > 0
					AND 	SYN.REP_SEQ = A.SEQ
					AND 	SYN.DELETE_YN ='N'
					GROUP BY SYN.REP_SEQ
				) AS SYNONYM_TERM
				,A.REP_YN
				,A.LANG
				,A.DELETE_YN
				,B.ITEM_CATE_SEQ
				,B.ITEM_CATE_DETL_SEQ
				,B.ITEM_SEQ
				,B.SEQ AS ITEM_MAP_SEQ
				,C.CATE_NM AS ITEM_CATE_NM
				,D.CATE_NM AS ITEM_CATE_DETL_NM
				,E.COLUMN_COMMENT AS ITEM_NM
				,DATE_FORMAT(A.CRT_DT, "%Y-%m-%d") AS CRT_DT
		FROM	CC_SYNONYM A
		LEFT OUTER JOIN CC_SYNONYM_ITEM_MAP B ON (A.SEQ = B.TERM_REP_SEQ)
		LEFT OUTER JOIN CC_ITEM_CATE C ON (C.SEQ = B.ITEM_CATE_SEQ)
		LEFT OUTER JOIN CC_ITEM_CATE_DETL D ON (D.SEQ = B.ITEM_CATE_DETL_SEQ)
		LEFT OUTER JOIN CC_ITEM_MGMT E ON (E.SEQ = B.ITEM_SEQ)
		WHERE	1=1
		AND 	REP_YN='Y'
		<if test="SEARCH_ITEM_CATE_SEQ != null and SEARCH_ITEM_CATE_SEQ != ''">
			AND 	B.ITEM_CATE_SEQ=#{SEARCH_ITEM_CATE_SEQ}
		</if>
		
		<if test="SEARCH_ITEM_CATE_DETL_SEQ != null and SEARCH_ITEM_CATE_DETL_SEQ != ''">
			AND 	B.ITEM_CATE_DETL_SEQ=#{SEARCH_ITEM_CATE_DETL_SEQ}
		</if>
		
		<if test="SEARCH_ITEM_SEQ != null and SEARCH_ITEM_SEQ != ''">
			AND 	B.ITEM_SEQ=#{SEARCH_ITEM_SEQ}
		</if>
		
		<if test="SEARCH_SEQ != null and SEARCH_SEQ != ''">
			AND 	A.SEQ=#{SEARCH_SEQ}
		</if>
		
		<if test="SEARCH_VAL != null and SEARCH_VAL != ''">
			<choose>
				<when test="SEARCH_KEY == '001'">
					AND 	A.REP_YN='Y'
					AND 	A.TERM LIKE CONCAT('%',#{SEARCH_VAL},'%')
			
				</when>
				<when test="SEARCH_KEY == '002'">
					AND 	A.SEQ IN (
						SELECT 	TB1.REP_SEQ 
						FROM	CC_SYNONYM TB1
						WHERE	1=1
						AND 	A.REP_YN='N'
						AND 	TB1.TERM LIKE CONCAT('%',#{SEARCH_VAL},'%')
					)
				</when>
				
				<otherwise>
					AND 	A.SEQ IN (
						SELECT 	TB1.REP_SEQ 
						FROM	CC_SYNONYM TB1
						WHERE	1=1
						AND 	TB1.TERM LIKE CONCAT('%',#{SEARCH_VAL},'%')
					)
				
				</otherwise>
			</choose>
				
			
		</if>
		AND A.DELETE_YN = 'N'
		ORDER BY SEQ DESC
	</select>
	
	<select id="selectSynonymTermListByRepTerm" parameterType="map"
		resultType="hashmap">
		SELECT   A.SEQ
				,A.REP_SEQ	
				,A.TERM
		FROM	CC_SYNONYM A
		WHERE	1=1
		AND 	A.REP_SEQ=#{SEARCH_REP_SEQ}
		AND 	A.DELETE_YN ='N'
	</select>
	
	
	
	<insert id="insertSynonymItemMap" parameterType="map">
	INSERT INTO CC_SYNONYM_ITEM_MAP
(
	 SEQ
	,ITEM_CATE_SEQ
	,ITEM_CATE_DETL_SEQ
	,ITEM_SEQ
	,TERM_REP_SEQ
	,CRT_DT
	,CRT_ID
	,UDT_DT
	,UDT_ID
)
VALUES
(
	 #{SEQ}
	,#{ITEM_CATE_SEQ}
	,#{ITEM_CATE_DETL_SEQ}
	,#{ITEM_SEQ}
	,#{TERM_REP_SEQ}
	,NOW()
	,#{CRT_ID}
	,NOW()
	,#{UDT_ID}
)ON DUPLICATE KEY UPDATE SEQ = #{SEQ},
							ITEM_CATE_SEQ = #{ITEM_CATE_SEQ},
							ITEM_CATE_DETL_SEQ=#{ITEM_CATE_DETL_SEQ},
							ITEM_SEQ=#{ITEM_SEQ},
							TERM_REP_SEQ=#{TERM_REP_SEQ},
							UDT_DT=NOW(),
							UDT_ID=#{UDT_ID}
	
	
		<!-- INSERT INTO CC_SYNONYM_ITEM_MAP
(
	ITEM_CATE_SEQ
	,ITEM_CATE_DETL_SEQ
	,ITEM_SEQ
	,TERM_REP_SEQ
	,CRT_DT
	,CRT_ID
	,UDT_DT
	,UDT_ID
)
VALUES
(
	 #{ITEM_CATE_SEQ}
	,#{ITEM_CATE_DETL_SEQ}
	,#{ITEM_SEQ}
	,#{TERM_REP_SEQ}
	,NOW()
	,#{CRT_ID}
	,NOW()
	,#{UDT_ID}


) -->
	
	</insert>
	<insert id="upsertSynonymTerm" parameterType="map">
	
	INSERT 	INTO CC_SYNONYM 
	(
		SEQ,REP_SEQ,TERM,LANG,REP_YN,DELETE_YN,UDT_DT,UDT_ID,CRT_ID,CRT_DT
	) 
	VALUES 
	(
		#{SEQ}
		,#{REP_SEQ} 
		,#{TERM}
		,#{LANG} 
		,#{REP_YN} 
		,#{DELETE_YN} 
		,NOW() 
		,#{UDT_ID} 
		,#{CRT_ID} 
		,NOW()
	)
	ON DUPLICATE KEY UPDATE SEQ = #{SEQ},
							REP_SEQ = #{REP_SEQ},
							TERM=#{TERM},
							LANG=#{LANG},
							REP_YN=#{REP_YN},
							DELETE_YN=#{DELETE_YN},
							UDT_DT=NOW(),
							UDT_ID='0000000'
	
	
	</insert>
	<update id="deleteSynonymTerm" parameterType="map">
		UPDATE  CC_SYNONYM 
		SET		DELETE_YN = 'Y'
		WHERE SEQ = #{SEQ}
	
	</update>



</mapper>
 
 
 