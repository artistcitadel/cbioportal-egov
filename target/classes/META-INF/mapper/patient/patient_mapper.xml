<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="patient">

    <select id="selectPatientCategory" resultType="com.softcen.bigcen.med.patient.vo.Patient">
        SELECT
        '1' checked,
        ITEM_ID id,
        ITEM_NM name,
        ITEM_CATE_ID pid
        FROM
             pmsportal.CC_ITEM_MGMT
        WHERE PROGRM_ID = 'PATIENT_TIME'
        AND length(ITEM_ID)>0
        UNION
        SELECT
                '1' checked,
               ITEM_CATE_ID id,
               ITEM_CATE_ID name,
                '0' pid
        FROM
             pmsportal.CC_ITEM_MGMT
        WHERE PROGRM_ID = 'PATIENT_TIME'
      /*SELECT
        '1' checked,
        ITEM_CATE_ID idd,
        ITEM_CATE_NM name,
        ''               as pid,
        'Y' AS DEFAULT_YN,
        1                  as level,
        min("ORDER") + 100 AS LEVEL_ORDER
        FROM pmsportal.CC_ITEM_MGMT
        WHERE PROGRM_ID = 'PATIENT_TIME'
        group by ITEM_CATE_ID, ITEM_CATE_NM
        union all
        SELECT
        '1' checked,
        ITEM_ID       as idd,
        ITEM_NM       as name,
        ITEM_CATE_ID  as pid,
        DEFAULT_YN,
        2             as "LEVEL",
        "ORDER" + 200 AS LEVEL_ORDER
        FROM pmsportal.CC_ITEM_MGMT
        WHERE PROGRM_ID = 'PATIENT_TIME'
        and ITEM_ID != ''
        and DEFAULT_YN = 'Y'
        group by ITEM_CATE_ID, DEFAULT_YN, ITEM_CATE_ID*/
    </select>

    <select id="selectPatientMutCol" resultType="com.softcen.bigcen.med.patient.vo.Patient">
        SELECT DISTINCT ITEM_CATE_ID subject, ITEM_ID id , ITEM_NM name FROM pmsportal.CC_ITEM_MGMT
        WHERE PROGRM_ID = 'PATIENT_MUTATION' AND LENGTH(ITEM_ID)>0 AND DEFAULT_YN = 'Y'
        ORDER BY 1
    </select>

    <select id="selectPatientChoiceList" resultType="com.softcen.bigcen.med.patient.vo.Patient">
      SELECT DISTINCT
                RESCH_PAT_ID patientId,
                'LABTEST' sampleId,
                '999' age,
                'LABTEST' cancerStudy,
                'LABTEST' cancerType,
                'LABTEST' cancerTypeDetail
     FROM CLSPNEXRT
    WHERE RESCH_PAT_ID = '6905950076'
    UNION
    select RESCH_PAT_ID patientId,
                    'PATHLOGY' sampleId,
                    '999' age,
                    'PATHLOGY' cancerStudy,
                    'PATHLOGY' cancerType,
                    'PATHLOGY' cancerTypeDetail
           from pmsdev.OOODMEXAM a join pmsdev.PMGEMEMTH b on a.ORDR_CD = b.EXAM_CD
            WHERE b.GENE_EXAM_MTH_NM != ' '
            AND a.RESCH_PAT_ID = '9984190521'
        union
    SELECT
                     '48321932' patientId,
                    'MUT' sampleId,
                    '999' age,
                    'MUT' cancerStudy,
                    'MUT' cancerType,
                    'MUT' cancerTypeDetail

        union
    SELECT
                     '51927545' patientId,
                    'CNA' sampleId,
                    '999' age,
                    'CNA' cancerStudy,
                    'CNA' cancerType,
                    'CNA' cancerTypeDetail
     union
    SELECT
                     '4176755120' patientId,
                    'EXP' sampleId,
                    '999' age,
                    'EXP' cancerStudy,
                    'EXP' cancerType,
                    'EXP' cancerTypeDetail
     union
    SELECT
                     '4176755120' patientId,
                    'EXP' sampleId,
                    '999' age,
                    'EXP' cancerStudy,
                    'EXP' cancerType,
                    'EXP' cancerTypeDetail
    </select>

    <select id="selectLabTestHrc" resultType="com.softcen.bigcen.med.patient.vo.Patient">
      SELECT DISTINCT
                'Lab_test' subject,
                EXAM_CD id,
                IFNULL(EXAM_ENG_NM, EXAM_CD) name
                FROM CLSPNEXRT
      <![CDATA[
        WHERE LENGTH(EXAM_CD) < 6
        AND RESCH_PAT_ID = #{patientId}
      ]]>
    </select>

    <select id="selectLabTest" resultType="com.softcen.bigcen.med.patient.vo.Patient">
     SELECT
     'Lab_test' subject,
     EXAM_SLIP_CD pid ,
                         EXAM_CD id,
                         IFNULL(EXAM_ENG_NM, EXAM_CD) name,
                         RCEP_DT time,
                         ROUND(IFNULL(SUM(EXAM_RSLT_VAL),0),2) exam,
                         ROUND(IFNULL(SUM(MARK_RSLT_VAL),0),2) mark,
                         ROUND(IFNULL(SUM(CRTE_MSR_VAL),0),2)  crte

        FROM CLSPNEXRT
        /*WHERE RESCH_PAT_ID = '6905950076' AND EXAM_CD IN ('DA0036','BD0012','BA0094') AND SUBSTRING(RCEP_DT,1,4) = '2017' OR (EXAM_CD='BD0012' AND RCEP_DT='20040427')*/
        WHERE RESCH_PAT_ID = #{patientId} /*AND EXAM_CD = 'AFIN'*/
        /*AND EXAM_ENG_NM = 'Rh variant Ag,Automation (Semi-Qn)[Agglutination],Blood'*/
        GROUP BY EXAM_SLIP_CD, EXAM_CD, EXAM_ENG_NM, RCEP_DT
        ORDER BY 2,3,5
        /*LIMIT  100*/
 	</select>


    <select id="selectPatientDescription" resultType="com.softcen.bigcen.med.patient.vo.Patient">
        SELECT m.RESCH_PAT_ID patientId,
        IFNULL((select AGE from WPPIMINFO where RESCH_PAT_ID = m.RESCH_PAT_ID LIMIT 1),'') age,
        IFNULL((select SEX_CD from WPPIMINFO where RESCH_PAT_ID = m.RESCH_PAT_ID LIMIT 1),'') sex,
        IFNULL( m.ONCOTREE_CD, '')  cancerType,
        IFNULL( m.PRMR_ORGAN_CD , '') cancerTypeDetail,
        IFNULL( m.MRPH_DIAG_CD, '') cancerMode
         from pmsdev.MSMAMCAMN m
         where m.RESCH_PAT_ID = #{patientId}

 	</select>

    <select id="selectPatientzz" parameterType="map" resultType="hashmap">
          ${query}
    </select>

    <insert id="insertBrc" parameterType="com.softcen.bigcen.med.patient.vo.Blood">
          INSERT INTO pmsportal.CC_RSCH_BRC
                (PER_CODE, RESCH_PAT_ID, EXAM_NO, SPCN_TYP_CD, SPCN_RSD_QT)
          values( #{perCode}, #{patientId}, #{examNo}, #{spcnTypCd}, #{spcnRsdQt} )
    </insert>

</mapper>


