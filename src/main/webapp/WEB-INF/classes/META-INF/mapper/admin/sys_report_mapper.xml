<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC  
 "-//mybatis.org//DTD Mapper 3.0//EN"  
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
 
 
 <mapper namespace="report">
	<insert id="saveReportCate" parameterType="map">
		INSERT 	INTO CC_REPORT_CATE 
		(
			 SEQ
			,NAME
			,ICON_PATH
			,SHOW_YN
			,`ORDER`
			,UDT_DT
			,UDT_ID
			,CRT_ID
			,CRT_DT
			,SHOW_DASHBOARD_GBN
		) 
		VALUES 
		(
			#{SEQ}
			,#{NAME}
			,#{ICON_PATH}
			,IFNULL(#{SHOW_YN},'N')
			,IFNULL((SELECT MAX(`ORDER`) + 1 FROM CC_REPORT_CATE A LIMIT 1),1)
			,NOW() 
			,#{UDT_ID}
			,#{CRT_ID}
			,NOW()
			,#{SHOW_DASHBOARD_GBN}
		)
		ON DUPLICATE KEY UPDATE SEQ = #{SEQ}
								,NAME = #{NAME}
								,ICON_PATH= #{ICON_PATH}
								,SHOW_YN=IFNULL(#{SHOW_YN},'N')
								,`ORDER`=IFNULL(#{ORDER},`ORDER`)
								,UDT_DT=NOW()
								,UDT_ID=#{UDT_ID}
								,SHOW_DASHBOARD_GBN=#{SHOW_DASHBOARD_GBN}
	</insert>
	
	
	<select id="selectReportCateList" parameterType="map" resultType="hashmap">
		SELECT   A.SEQ
				,A.NAME
				,A.ICON_PATH
				,A.SHOW_YN
				,A.`ORDER`
				,A.UDT_DT
				,A.UDT_ID
				,A.CRT_DT
				,A.CRT_ID
				,A.SHOW_DASHBOARD_GBN
		FROM	CC_REPORT_CATE A
		WHERE	1=1
		ORDER BY A.ORDER ASC
	</select>
	
	
	<insert id="saveReportPage" parameterType="map">
	INSERT 	INTO CC_REPORT_PAGE 
		(
			 SEQ
			,CATE_CODE
			,TITLE
			,URL
			,USER_ID
			,TARGET_ID
			,AUT_CODE
			,SHOW_YN
			,`ORDER`
			,UDT_DT
			,UDT_ID
			,CRT_ID
			,CRT_DT
		) 
		VALUES 
		(
			#{SEQ}
			,#{CATE_CODE}
			,#{TITLE}
			,#{URL}
			,#{USER_ID}
			,#{TARGET_ID}
			,#{AUT_CODE}
			,IFNULL(#{SHOW_YN},'N')
			,(
				SELECT 	IFNULL(MAX(A.ORDER)+ 1,1) 
				FROM	CC_REPORT_PAGE A 
				WHERE 	1=1
				AND 	A.CATE_CODE=#{CATE_CODE}
			)
			,NOW() 
			,#{UDT_ID}
			,#{CRT_ID}
			,NOW()
		)
		ON DUPLICATE KEY UPDATE SEQ = #{SEQ}
								,CATE_CODE=#{CATE_CODE}
								,TITLE=#{TITLE}
								,URL=#{URL}
								,USER_ID=#{USER_ID}
								,TARGET_ID=#{TARGET_ID}
								,SHOW_YN=IFNULL(#{SHOW_YN},'N')
								,`ORDER`=IFNULL(#{ORDER},`ORDER`)
								,AUT_CODE=#{AUT_CODE}
								,UDT_DT=NOW()
								,UDT_ID=#{UDT_ID}
	
	</insert>
	<select id="selectReportPageList" parameterType="map" resultType="hashmap">
		SELECT 	 A.SEQ
				,A.CATE_CODE
				,B.NAME AS CATE_NM
				,A.TITLE
				,A.URL
				,A.USER_ID
				,A.TARGET_ID
				,A.AUT_CODE
				,(
					SELECT 	TB1.AUT_NAME 
					FROM 	CC_AUTINX TB1 
					WHERE 	1=1 
					AND		TB1.AUT_CODE=A.AUT_CODE 
				) AS AUT_NAME
				,A.SHOW_YN
				,A.ORDER
		FROM	CC_REPORT_PAGE A
			   ,CC_REPORT_CATE B
		WHERE 	1=1
		AND 	A.CATE_CODE=B.SEQ
		AND 	A.CATE_CODE= #{SEARCH_CATE_CODE}
		
		<if test="SEARCH_SEQ != null and SEARCH_SEQ != ''">
			AND	A.SEQ = #{SEARCH_SEQ}
		</if>
		ORDER BY A.ORDER ASC
	</select>
	
	
	<!-- 보고서분류삭제 -->
	<delete id="deleteReportCate" parameterType="map">
		DELETE FROM CC_REPORT_CATE WHERE SEQ=#{CATE_CODE}
	</delete>
	
	<!-- 보고서분류별 페이지삭제 -->
	<delete id="deleteReportPageByCateCode" parameterType="map">
		DELETE FROM CC_REPORT_PAGE WHERE CATE_CODE=#{CATE_CODE}
	</delete>
	
	<!-- 보고서페이지 삭제 -->
	<delete id="deleteReportPage" parameterType="map">
		DELETE FROM CC_REPORT_PAGE WHERE SEQ=#{SEQ}
	</delete>



</mapper>
 
 
 